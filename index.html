<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Dashboard - Inspeções</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --primary:#0097CE;
      --primary-dark:#007fb0;
      --bg:#f4f6f8;
      --card:#fff;
      --text:#333;
      --border:#e0e0e0;
      --danger:#b3261e;
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:"Segoe UI",Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{
      background:var(--card);
      padding:16px 24px;
      display:flex;align-items:center;gap:12px;flex-wrap:wrap;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
      position:sticky;top:0;z-index:10;
    }
    header h2{margin:0;color:var(--primary);display:flex;align-items:center;gap:8px;font-size:18px;}
    .top-actions{margin-left:auto;display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    input,select{
      padding:8px 10px;border:1px solid var(--border);border-radius:10px;background:#fff;font-size:14px;outline:none;
    }
    button,.btn-link{
      padding:9px 14px;border-radius:10px;border:none;cursor:pointer;font-size:14px;
      display:inline-flex;align-items:center;gap:8px;white-space:nowrap;
    }
    button{background:var(--primary);color:#fff;}
    button:hover{background:var(--primary-dark);}
    button.secondary,.btn-link{
      background:#fff;color:#333;border:1px solid var(--border);text-decoration:none;
    }
    button.secondary:hover,.btn-link:hover{background:#f3f3f3;}
    main{padding:24px;}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:end;margin-bottom:14px;}
    .status{font-size:14px;color:#555;min-width:240px;flex:1;}
    .status.success{color:#137333;}
    .status.error{color:var(--danger);}
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      align-items:stretch;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:14px;
      box-shadow:0 4px 12px rgba(0,0,0,.06);
      overflow:hidden;
    }
    .pad{padding:14px;}
    .kpi{
      display:flex;flex-direction:column;gap:6px;
      min-height:96px;
    }
    .kpi .label{font-size:12px;color:#666;font-weight:700;}
    .kpi .value{font-size:28px;font-weight:900;line-height:1;}
    .kpi .sub{font-size:12px;color:#777;}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;border:1px solid var(--border);
      background:#fff;font-size:13px;color:#444;font-weight:700;
    }
    .divider{height:1px;background:var(--border);margin:12px 0;}
    canvas{width:100%;height:320px;display:block;}
    .chart-title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
    }
    .chart-title h3{margin:0;color:var(--primary);font-size:16px;}
    .hint{font-size:12px;color:#777;}
  </style>
</head>

<body>
  <header>
    <h2><i class="bi bi-speedometer2"></i> Dashboard - Inspeções</h2>

    <div class="top-actions">
      <a class="btn-link" href="https://coec-epb.github.io/inspecoes/" title="Voltar para Inspeções">
        <i class="bi bi-arrow-left"></i> Inspeções
      </a>
      <button class="secondary" id="btnAtualizar">
        <i class="bi bi-arrow-repeat"></i> Atualizar
      </button>
      <button class="secondary" onclick="logout()">
        <i class="bi bi-box-arrow-right"></i> Sair
      </button>
    </div>
  </header>

  <main>
    <!-- filtros -->
    <div class="card pad">
      <div class="row">
        <div>
          <div class="hint" style="font-weight:700;margin-bottom:6px;">Mês</div>
          <input id="filtroMes" type="month" style="width:180px;">
        </div>

        <div>
          <div class="hint" style="font-weight:700;margin-bottom:6px;">Regional</div>
          <select id="filtroRegional" style="min-width:180px;">
            <option value="">Todas</option>
            <option value="CENTRO">CENTRO</option>
            <option value="LESTE">LESTE</option>
            <option value="OESTE">OESTE</option>
          </select>
        </div>

        <div style="flex:1;min-width:260px;">
          <div class="hint" style="font-weight:700;margin-bottom:6px;">Supervisor (Líder)</div>
          <select id="filtroSupervisor" style="width:100%;">
            <option value="">Todos</option>
          </select>
        </div>

        <div id="status" class="status"></div>
      </div>

      <div class="divider"></div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <span class="pill"><i class="bi bi-info-circle"></i> Filtros aplicam em KPIs e gráficos</span>
        <span class="pill"><i class="bi bi-people"></i> Abrangência = inspecionados / total colaboradores</span>
      </div>
    </div>

    <!-- KPIs -->
    <div class="grid" style="margin-top:12px;">
      <div class="card pad" style="grid-column: span 4;">
        <div class="kpi">
          <div class="label">Qtd. Inspeções</div>
          <div class="value" id="kpiInspecoes">0</div>
          <div class="sub" id="kpiInspecoesSub">—</div>
        </div>
      </div>

      <div class="card pad" style="grid-column: span 4;">
        <div class="kpi">
          <div class="label">Qtd. Não Conformidades</div>
          <div class="value" id="kpiNC">0</div>
          <div class="sub" id="kpiNCSub">—</div>
        </div>
      </div>

      <div class="card pad" style="grid-column: span 4;">
        <div class="kpi">
          <div class="label">Abrangência</div>
          <div class="value" id="kpiAbrangencia">0%</div>
          <div class="sub" id="kpiAbrangenciaSub">0 inspecionados / 0 total</div>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="grid" style="margin-top:12px;">
      <div class="card pad" style="grid-column: span 6;">
        <div class="chart-title">
          <h3><i class="bi bi-graph-up"></i> Frequência semanal (mês)</h3>
          <div class="hint">Soma de inspeções por semana (1..5)</div>
        </div>
        <div style="margin-top:10px;">
          <canvas id="cvFrequencia"></canvas>
        </div>
      </div>

      <div class="card pad" style="grid-column: span 6;">
        <div class="chart-title">
          <h3><i class="bi bi-bar-chart"></i> Inspeções x NC por mês (ano)</h3>
          <div class="hint">Ano = ano do mês selecionado</div>
        </div>
        <div style="margin-top:10px;">
          <canvas id="cvAno"></canvas>
        </div>
      </div>
    </div>
  </main>

<script>
/* ============================
   CONFIG / SESSÃO
============================ */
const API = "https://inspecoes.pedro-fillype.workers.dev";

function logout(){
  localStorage.removeItem("logado");
  localStorage.removeItem("token");
  localStorage.removeItem("perfil");
  localStorage.removeItem("lider");
  window.location.href = "https://coec-epb.github.io/login_inspecoes/";
}

if (localStorage.getItem("logado") !== "true") logout();
const token = String(localStorage.getItem("token") || "").trim();
if (!token) logout();

function setStatus(msg, type=""){
  const el = document.getElementById("status");
  if (!el) return;
  el.textContent = msg;
  el.className = "status " + (type || "");
}

async function apiFetch(path, options={}){
  return fetch(`${API}${path}`, {
    ...options,
    headers: {
      Authorization: `Bearer ${token}`,
      ...(options.headers || {})
    }
  });
}

/* ============================
   TOKEN HELPERS (compat)
============================ */
function b64urlToString(b64url) {
  try {
    let b64 = String(b64url || "").replace(/-/g, "+").replace(/_/g, "/");
    while (b64.length % 4) b64 += "=";
    return atob(b64);
  } catch { return ""; }
}

function decodeTokenPayloadCompat(token) {
  try {
    const parts = String(token || "").split(".");
    if (parts.length < 2) return null;

    const maybeWorkerBody = parts[0];
    const maybeJwtPayload = parts[1];

    const workerJson = b64urlToString(maybeWorkerBody);
    if (workerJson && workerJson.trim().startsWith("{")) return JSON.parse(workerJson);

    const jwtJson = b64urlToString(maybeJwtPayload);
    if (jwtJson && jwtJson.trim().startsWith("{")) return JSON.parse(jwtJson);

    return null;
  } catch { return null; }
}

function getNomeDoToken(){
  const lsLider = String(localStorage.getItem("lider") || "").trim();
  if (lsLider) return lsLider;

  const payload = decodeTokenPayloadCompat(token);
  if (!payload) return "";
  return String(payload.lider || payload.nome || payload.name || "").trim();
}

/* ============================
   MAPA LÍDER -> REGIONAL
============================ */
const REGIONAL_POR_LIDER = {
  "ANDERSON DE ARAUJO VASCONCELOS": "CENTRO",
  "EDEVALDO FELICIANO DA SILVA": "CENTRO",
  "ALEXANDRE BATISTA DIAS": "OESTE",
  "DAVIDSON DA SILVA GOMES": "CENTRO",
  "THOMAZ CHAVES DO NASCIMENTO": "LESTE",
  "WESLEY FERNANDES DE SOUZA": "LESTE",
  "JANSEN LACERDA DE OLIVEIRA JUNIOR": "OESTE",
  "FABIANO OLIVEIRA DE MENEZES": "OESTE",
  "CRISTIANO CAETANO MADEIRO": "OESTE",
  "NATHALIA HOLANDA VILHENA": "LESTE",
  "EDIVALDO DA SILVA BRANDAO NETO": "LESTE",
  "RENAN IGOR MENEZES DA SILVA": "CENTRO",
  "MACIEL GOMES DE AGUIAR": "CENTRO",
  "DELMIR BARBOSA MAXIMIANO": "LESTE",
  "FABIO LIMA DE FRANCA": "LESTE",
  "YURI VILMAR BATISTA MELO": "LESTE",
  "MARCONE HENRIQUE DA CRUZ": "OESTE",
  "RENATO LINS DE VASCONCELOS NETO": "LESTE",
  "FABRICIO ANDRE SILVA DE ARAUJO": "LESTE",
  "GERALDO PEDRO DA SILVA JUNIOR": "LESTE",
  "RICHARDSON SILVA DE OLIVEIRA": "LESTE"
};

function normName(s){
  return String(s || "")
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/\s+/g," ").trim().toUpperCase();
}

/* ============================
   DATAS
============================ */
function mesAtualYYYYMM(){
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;
}
function mesToRange(mesYYYYMM){
  const [y,m] = String(mesYYYYMM||"").split("-");
  if (!y || !m) return {ini:"", fim:""};
  return { ini:`${y}-${m}-01`, fim:`${y}-${m}-31`, ano:y };
}

function weekOfMonth(d){
  return Math.floor((d.getDate()-1)/7)+1; // 1..5
}
function parseISODateFlex(v){
  const s = String(v||"").trim();
  if (!s) return null;
  const iso = s.slice(0,10);
  const dt = new Date(`${iso}T00:00:00`);
  return isNaN(dt.getTime()) ? null : dt;
}

/* ============================
   LOADERS
============================ */
async function carregarSupervisoresNoSelect(){
  const sel = document.getElementById("filtroSupervisor");
  if (!sel) return;

  // monta da lista fixa (mapa)
  const lideres = Object.keys(REGIONAL_POR_LIDER)
    .sort((a,b)=> normName(a).localeCompare(normName(b)));

  sel.innerHTML = `<option value="">Todos</option>` +
    lideres.map(l => `<option value="${l.replaceAll('"',"&quot;")}">${l}</option>`).join("");

  // opcional: pré-seleciona o líder do login (se existir no mapa)
  const meu = normName(getNomeDoToken());
  const found = lideres.find(x => normName(x) === meu);
  if (found) sel.value = found;
}

async function fetchInspecoesRange(ini, fim){
  // seu worker já usa data_ini/data_fim e lider quando quer
  const qs = new URLSearchParams();
  if (ini) qs.set("data_ini", ini);
  if (fim) qs.set("data_fim", fim);

  const res = await apiFetch(`/inspecoes?${qs.toString()}`);
  const text = await res.text();
  if (!res.ok) throw new Error(text);

  const data = JSON.parse(text);
  return Array.isArray(data) ? data : (data.results || []);
}

async function fetchNaoConformidades(){
  // tolerante: pode retornar array, ou {results}, etc
  const res = await apiFetch(`/nao-conformidades`);
  const text = await res.text();
  if (!res.ok) throw new Error(text);

  const data = JSON.parse(text);
  if (Array.isArray(data)) return data;
  if (Array.isArray(data.results)) return data.results;
  return [];
}

async function fetchRankingColaboradores(){
  // usado para "total colaboradores" (abrangência)
  const res = await apiFetch(`/ranking-colaboradores`);
  const text = await res.text();
  if (!res.ok) throw new Error(text);
  const data = JSON.parse(text);
  return Array.isArray(data.results) ? data.results : [];
}

/* ============================
   FILTRO DE ESCOPO (Regional/Supervisor)
============================ */
function matchEscopoInspecao(item, regional, supervisor){
  // Regional sempre baseado no LÍDER "dono" da inspeção
  const lider = String(item?.lider || "").trim();
  const reg = REGIONAL_POR_LIDER[lider] || "";

  if (regional && reg !== regional) return false;

  // ✅ Se NÃO escolheu supervisor: cada inspeção vale 1 (sem regra de “participação”)
  if (!supervisor) return true;

  // ✅ Se escolheu supervisor: conta se ele participou (lider/auditores/cadastrante)
  const alvo = normName(supervisor);

  const campos = [
    item?.cadastrante,
    item?.lider,
    item?.auditor_1,
    item?.auditor_2,
    item?.auditor_3
  ].map(normName).filter(Boolean);

  return campos.includes(alvo);
}

function matchEscopoNC(item, regional, supervisor){
  // NC também tem "lider" no seu import
  const lider = String(item?.lider || "").trim();
  const reg = REGIONAL_POR_LIDER[lider] || "";

  if (regional && reg !== regional) return false;
  if (supervisor && lider !== supervisor) return false;
  return true;
}

/* ============================
   ABRANGÊNCIA
   - total colaboradores: ranking-colaboradores filtrado por escopo (lider/regional)
   - inspecionados: únicos encontrados nas inspeções (auditados + colaborador_1 + colaborador_2)
============================ */
function splitNomesCampo(v){
  const s = String(v||"").trim();
  if (!s) return [];
  return s
    .split(/[,;|]/g)
    .map(x => x.trim())
    .filter(Boolean);
}

function calcAbrangencia(inspecoesFiltradas, rankingFiltrado){
  const totalSet = new Set();
  rankingFiltrado.forEach(r=>{
    const nome = String(r.colaborador || "").trim();
    if (nome) totalSet.add(normName(nome));
  });

  const inspSet = new Set();
  inspecoesFiltradas.forEach(i=>{
    // tenta pegar pessoas auditadas/colab
    splitNomesCampo(i.auditados).forEach(n => inspSet.add(normName(n)));
    splitNomesCampo(i.colaborador_1).forEach(n => inspSet.add(normName(n)));
    splitNomesCampo(i.colaborador_2).forEach(n => inspSet.add(normName(n)));
  });

  const total = totalSet.size;
  const inspecionados = [...inspSet].filter(n => totalSet.has(n)).length;

  const pct = total > 0 ? (inspecionados / total) * 100 : 0;
  return { total, inspecionados, pct };
}

/* ============================
   GRÁFICOS (Canvas simples)
============================ */
function drawBars(canvas, labels, valuesA, valuesB, labelA="A", labelB="B"){
  const ctx = canvas.getContext("2d");

  const W = canvas.clientWidth || 900;
  const H = canvas.clientHeight || 320;
  canvas.width = W;
  canvas.height = H;

  ctx.clearRect(0,0,W,H);

  const pad = 40;
  const chartW = W - pad*2;
  const chartH = H - pad*2;

  const maxV = Math.max(1, ...valuesA, ...valuesB);
  const cols = labels.length;

  // eixos
  ctx.strokeStyle = "#ddd";
  ctx.beginPath();
  ctx.moveTo(pad, pad);
  ctx.lineTo(pad, H-pad);
  ctx.lineTo(W-pad, H-pad);
  ctx.stroke();

  // grid
  ctx.fillStyle = "#666";
  ctx.font = "12px Segoe UI, Arial";
  const steps = 4;
  for(let s=0;s<=steps;s++){
    const v = (maxV/steps)*s;
    const y = (H-pad) - (v/maxV)*chartH;
    ctx.strokeStyle="#efefef";
    ctx.beginPath();
    ctx.moveTo(pad, y);
    ctx.lineTo(W-pad, y);
    ctx.stroke();
    ctx.fillStyle="#666";
    ctx.fillText(String(Math.round(v)), 8, y+4);
  }

  const groupW = chartW / cols;
  const barW = Math.max(10, Math.min(18, groupW/4));
  const gap = barW;

  for(let i=0;i<cols;i++){
    const x0 = pad + i*groupW + (groupW - (barW*2 + gap))/2;

    const hA = (valuesA[i]/maxV)*chartH;
    const hB = (valuesB[i]/maxV)*chartH;

    // A
    ctx.fillStyle = "rgba(0,151,206,.25)";
    ctx.strokeStyle = "rgba(0,151,206,.35)";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.rect(x0, (H-pad)-hA, barW, hA);
    ctx.fill(); ctx.stroke();

    // B
    ctx.fillStyle = "rgba(255,99,71,.25)";
    ctx.strokeStyle = "rgba(255,99,71,.35)";
    ctx.beginPath();
    ctx.rect(x0+barW+gap, (H-pad)-hB, barW, hB);
    ctx.fill(); ctx.stroke();

    // label
    ctx.fillStyle="#555";
    ctx.fillText(labels[i], pad + i*groupW + 6, H - pad + 18);
  }

  // legenda
  ctx.fillStyle = "rgba(0,151,206,.25)";
  ctx.fillRect(W-pad-180, pad-18, 12, 12);
  ctx.strokeStyle = "rgba(0,151,206,.35)";
  ctx.strokeRect(W-pad-180, pad-18, 12, 12);
  ctx.fillStyle="#444";
  ctx.fillText(labelA, W-pad-160, pad-8);

  ctx.fillStyle = "rgba(255,99,71,.25)";
  ctx.fillRect(W-pad-100, pad-18, 12, 12);
  ctx.strokeStyle = "rgba(255,99,71,.35)";
  ctx.strokeRect(W-pad-100, pad-18, 12, 12);
  ctx.fillStyle="#444";
  ctx.fillText(labelB, W-pad-80, pad-8);
}

function calcWeeksFromInspecoes(inspecoes){
  const weeks = [0,0,0,0,0];
  inspecoes.forEach(i=>{
    const dt = parseISODateFlex(i.data_inspecao);
    if(!dt) return;
    const w = weekOfMonth(dt);
    if(w>=1 && w<=5) weeks[w-1]++;
  });
  return weeks;
}

function drawWeeks(canvas, weeks){
  const labels = ["S1","S2","S3","S4","S5"];
  // usa drawBars com B zerado só pra reaproveitar
  drawBars(canvas, labels, weeks, [0,0,0,0,0], "Inspeções", "");
}

/* ============================
   DASHBOARD CORE
============================ */
function nomeMes(mm){
  const map = {"01":"Jan","02":"Fev","03":"Mar","04":"Abr","05":"Mai","06":"Jun","07":"Jul","08":"Ago","09":"Set","10":"Out","11":"Nov","12":"Dez"};
  return map[mm] || mm;
}

async function atualizarDashboard(){
  try{
    setStatus("Carregando dados...", "");
    const mes = document.getElementById("filtroMes")?.value || mesAtualYYYYMM();
    const regional = document.getElementById("filtroRegional")?.value || "";
    const supervisor = document.getElementById("filtroSupervisor")?.value || "";

    const {ini, fim, ano} = mesToRange(mes);

    // 1) inspeções do mês (para KPI e frequência)
    const inspecoesMes = await fetchInspecoesRange(ini, fim);
    const inspecoesFiltradas = inspecoesMes.filter(i => matchEscopoInspecao(i, regional, supervisor));

    // 2) NC (para KPI)
    const ncs = await fetchNaoConformidades();
    const ncsFiltradas = ncs
      .filter(nc => String(nc.status||"").trim().toUpperCase() === "ATRASADO" || String(nc.status||"").trim() !== "") // mantém, mas conta todas abaixo
      .filter(nc => matchEscopoNC(nc, regional, supervisor));

    // conta NC total no escopo (se quiser só "Atrasado", muda aqui)
    const totalNC = ncsFiltradas.length;

    // 3) abrangência: usa ranking-colaboradores como base de "total colaboradores"
    const ranking = await fetchRankingColaboradores();
    const rankingFiltrado = ranking.filter(r=>{
  const liderR = String(r.lider||"").trim();
  const reg = REGIONAL_POR_LIDER[liderR] || "";

  if (regional && reg !== regional) return false;

  // ✅ quando seleciona supervisor, abrangência fica daquele líder
  if (supervisor && liderR !== supervisor) return false;

  return true;
});

    const ab = calcAbrangencia(inspecoesFiltradas, rankingFiltrado);

    // KPIs
    document.getElementById("kpiInspecoes").textContent = inspecoesFiltradas.length;
    document.getElementById("kpiInspecoesSub").textContent =
      supervisor ? `Supervisor: ${supervisor}` : (regional ? `Regional: ${regional}` : "Geral (todas regionais)");

    document.getElementById("kpiNC").textContent = totalNC;
    document.getElementById("kpiNCSub").textContent =
      `Escopo do mês ${mes} • (filtro Regional/Supervisor aplicado)`;

    document.getElementById("kpiAbrangencia").textContent = `${ab.pct.toFixed(1).replace(".",",")}%`;
    document.getElementById("kpiAbrangenciaSub").textContent =
      `${ab.inspecionados} inspecionados / ${ab.total} total`;

    // gráfico frequência semanal
    const weeks = calcWeeksFromInspecoes(inspecoesFiltradas);
    drawWeeks(document.getElementById("cvFrequencia"), weeks);

    // gráfico ano: pega stats do backend, e filtra pelo escopo via inspeções (fallback)
    // Como seu /stats-mensal hoje é mais global, aqui vai uma versão robusta:
    // - busca mês-a-mês de inspeções do ano e agrega em JS (pode pesar, mas é confiável).
    const labelsAno = ["01","02","03","04","05","06","07","08","09","10","11","12"].map(nomeMes);

    const insAno = [];
    const ncAno = [];

    for(let mm=1; mm<=12; mm++){
      const mesKey = `${ano}-${String(mm).padStart(2,"0")}`;
      const r = mesToRange(mesKey);
      const ins = await fetchInspecoesRange(r.ini, r.fim);
      const insF = ins.filter(i => matchEscopoInspecao(i, regional, supervisor));
      insAno.push(insF.length);

      // NC por mês: tenta filtrar por datas se existir campo inicio/termino/inicio_acao etc (pode variar)
      const ncsMes = ncsFiltradas.filter(nc=>{
        const dt =
          parseISODateFlex(nc.inicio_acao) ||
          parseISODateFlex(nc.termino_acao) ||
          parseISODateFlex(nc.inicio) ||
          parseISODateFlex(nc.termino);
        if(!dt) return false;
        const mk = `${dt.getFullYear()}-${String(dt.getMonth()+1).padStart(2,"0")}`;
        return mk === mesKey;
      });
      ncAno.push(ncsMes.length);
    }

    drawBars(document.getElementById("cvAno"), labelsAno, insAno, ncAno, "Inspeções", "NC");

    setStatus(`Dashboard atualizado • Mês ${mes}`, "success");
  } catch(e){
    console.error(e);
    setStatus("Erro ao carregar dashboard (veja o console).", "error");
  }
}

/* ============================
   INIT
============================ */
(function init(){
  const mesEl = document.getElementById("filtroMes");
  if (mesEl && !mesEl.value) mesEl.value = mesAtualYYYYMM();

  carregarSupervisoresNoSelect();

  document.getElementById("btnAtualizar")?.addEventListener("click", atualizarDashboard);
  document.getElementById("filtroMes")?.addEventListener("change", atualizarDashboard);
  document.getElementById("filtroRegional")?.addEventListener("change", atualizarDashboard);
  document.getElementById("filtroSupervisor")?.addEventListener("change", atualizarDashboard);

  atualizarDashboard();
})();
</script>

</body>
</html>
